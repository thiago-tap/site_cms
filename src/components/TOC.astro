---
interface Props {
  headings: { depth: number; text: string; slug: string }[];
}
const { headings } = Astro.props;
---

{headings.length > 1 && (
  <nav id="toc" class="bg-zinc-900 border border-zinc-800 rounded-xl p-5 mb-8 not-prose">
    <button id="toc-toggle" class="flex items-center justify-between w-full text-left">
      <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">√çndice</p>
      <svg id="toc-chevron" class="w-4 h-4 text-zinc-600 transition-transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6"/>
      </svg>
    </button>
    <ol id="toc-list" class="mt-3 space-y-1.5">
      {headings.map(({ depth, text, slug }) => (
        <li class={depth === 3 ? 'ml-4' : ''}>
          <a
            href={`#${slug}`}
            data-slug={slug}
            class="toc-link text-sm text-zinc-400 hover:text-indigo-400 transition-colors"
          >
            {text}
          </a>
        </li>
      ))}
    </ol>
  </nav>
)}

<script>
  // Toggle TOC on mobile
  const toggle = document.getElementById('toc-toggle');
  const list = document.getElementById('toc-list');
  const chevron = document.getElementById('toc-chevron');
  toggle?.addEventListener('click', () => {
    const hidden = list?.style.display === 'none';
    if (list) list.style.display = hidden ? '' : 'none';
    chevron?.style.setProperty('transform', hidden ? '' : 'rotate(-90deg)');
  });

  // Highlight active heading on scroll
  const links = document.querySelectorAll<HTMLAnchorElement>('.toc-link');
  const headingEls = Array.from(links).map((a) => document.getElementById(a.dataset.slug!)).filter(Boolean) as HTMLElement[];

  function highlightActive() {
    let active = headingEls[0];
    for (const h of headingEls) {
      if (h.getBoundingClientRect().top <= 100) active = h;
    }
    links.forEach((a) => {
      const isActive = a.dataset.slug === active?.id;
      a.classList.toggle('text-indigo-400', isActive);
      a.classList.toggle('text-zinc-400', !isActive);
    });
  }
  window.addEventListener('scroll', highlightActive, { passive: true });
  highlightActive();
</script>
