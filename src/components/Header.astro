---
import { getSettings } from '../lib/settings';
const user = Astro.locals.user;
const path = Astro.url.pathname;
const config = Astro.locals.runtime?.env?.DB
  ? await getSettings(Astro.locals.runtime.env.DB)
  : null;
const siteName = config?.site_name ?? 'Blog do Thiago';
const logoUrl = config?.logo_url ?? '';
---

<header class="sticky top-0 z-50 bg-zinc-950/80 backdrop-blur-sm border-b border-zinc-800">
  <div class="max-w-4xl mx-auto px-4 h-14 flex items-center justify-between">
    <a href="/" class="flex items-center gap-2 font-bold text-zinc-100 hover:text-white transition-colors">
      {logoUrl ? (
        <img src={logoUrl} alt={siteName} class="h-6 w-auto" />
      ) : (
        <svg class="w-5 h-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
        </svg>
      )}
      {siteName}
    </a>

    <nav class="flex items-center gap-4">
      <a href="/" class={`text-sm transition-colors ${path === '/' ? 'text-zinc-100' : 'text-zinc-400 hover:text-zinc-100'}`}>Blog</a>
      <a href="/sobre" class={`text-sm transition-colors ${path === '/sobre' ? 'text-zinc-100' : 'text-zinc-400 hover:text-zinc-100'}`}>Sobre</a>
      <a href="/contato" class={`text-sm transition-colors ${path === '/contato' ? 'text-zinc-100' : 'text-zinc-400 hover:text-zinc-100'}`}>Contato</a>
      <a href="/busca" title="Buscar" class="text-zinc-400 hover:text-zinc-100 transition-colors">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
      </a>
      {user ? (
        <>
          <a href="/admin" class={`text-sm transition-colors ${path.startsWith('/admin') ? 'text-indigo-400' : 'text-zinc-400 hover:text-zinc-100'}`}>Admin</a>
          <form action="/auth/logout" method="POST">
            <button type="submit" class="flex items-center gap-2 text-sm text-zinc-500 hover:text-zinc-100 transition-colors">
              <img src={user.avatarUrl ?? `https://github.com/${user.username}.png`} alt={user.username} class="w-6 h-6 rounded-full" />
              Sair
            </button>
          </form>
        </>
      ) : (
        <a href="/auth/github" class="text-sm px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md transition-colors">Login</a>
      )}
    </nav>
  </div>
</header>
